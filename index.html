<!DOCTYPE html>

<html>
<head>
  <title>NovaLogoLibrary.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>NovaLogoLibrary.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>constants</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> pi = <span class="hljs-built_in">Math</span>.PI;
<span class="hljs-keyword">var</span> piOver2 = <span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">2</span>;
<span class="hljs-keyword">var</span> negativePiOver2 = -<span class="hljs-built_in">Math</span>.PI/<span class="hljs-number">2</span>;
<span class="hljs-keyword">var</span> negativePi = -<span class="hljs-built_in">Math</span>.PI;
<span class="hljs-keyword">var</span> pi2 = <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>utilities</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> normalize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">theta</span>) </span>{
  <span class="hljs-keyword">var</span> ntheta = theta % pi2;
  <span class="hljs-keyword">if</span> (ntheta &gt; <span class="hljs-built_in">Math</span>.PI) ntheta -= pi2;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ntheta &lt;= -<span class="hljs-built_in">Math</span>.PI) ntheta += pi2;
  <span class="hljs-keyword">return</span> ntheta;
};

<span class="hljs-keyword">var</span> radiansToDegrees = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">theta</span>)</span>{
  <span class="hljs-keyword">return</span> theta * <span class="hljs-number">180</span> / <span class="hljs-built_in">Math</span>.PI;
};


<span class="hljs-keyword">var</span> degreesToRadians = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">degrees</span>)</span>{
  <span class="hljs-keyword">return</span> degrees * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span>;
};

<span class="hljs-keyword">var</span> checkInBounds = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">potentialX,potentialY,environment</span>)</span>{

  <span class="hljs-keyword">if</span>(potentialX &gt; environment.cols - <span class="hljs-number">1</span> || potentialX &lt; <span class="hljs-number">0</span>){
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(potentialY &gt; environment.rows - <span class="hljs-number">1</span> || potentialY &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  } <span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
}

<span class="hljs-keyword">var</span> subtractHeadings = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">heading1,heading2</span>)</span>{
  <span class="hljs-keyword">return</span> normalize(heading1-heading2);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>primitives</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> forward = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">distance,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>agent has two thetas
one theta is the theta of the model
the other theta is the theta of the agent</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>the agent theta,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;

  <span class="hljs-keyword">var</span> normalizedTheta = normalize(agentTheta);

  <span class="hljs-keyword">var</span> dx = distance * COS(normalizedTheta);
  <span class="hljs-keyword">var</span> dy = distance * SIN(normalizedTheta);

  <span class="hljs-keyword">var</span> nextX = agentX + dx;
  <span class="hljs-keyword">var</span> nextY = agentY + dy;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>distance is within rounding error
precision can be added
print(DISTANCE(currentX,currentY,nextX,nextY));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  agent.MOVE(nextX,nextY);
};


<span class="hljs-keyword">var</span> back = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">distance,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>agent has two thetas
one theta is the theta of the model
the other theta is the theta of the agent</p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>the agent theta,,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>to go back, we add pi to theta
this can create values greater than 2*pi
so we normalize</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> backTheta = agentTheta + <span class="hljs-built_in">Math</span>.PI;

  <span class="hljs-keyword">var</span> normalizedTheta = normalize(backTheta);

  <span class="hljs-keyword">var</span> dx = distance * COS(normalizedTheta);
  <span class="hljs-keyword">var</span> dy = distance * SIN(normalizedTheta);

  <span class="hljs-keyword">var</span> nextX = agentX + dx;
  <span class="hljs-keyword">var</span> nextY = agentY + dy;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>distance is within rounding error
precision can be added
print(DISTANCE(currentX,currentY,nextX,nextY));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  agent.MOVE(nextX,nextY);
};



<span class="hljs-keyword">var</span> jump = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">distance,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>interesting
the implementation of forward and jump are the same in Nova
netlogo introduces the idea of forward as an interpolation
between two points, where the agent exists in the intermediate points
while moving forward</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>and jump just puts them at the next position
so technically… jump and move are the same in nova
a move, is just done with a smaller step interval.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
}


<span class="hljs-keyword">var</span> left = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">degreeChange,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>agent has two thetas
one theta is the theta of the model
the other theta is the theta of the agent</p>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>the agent theta,,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>take the current heading
convert to degree
add degreeChange
convert to radian
normalize
pass to set heading</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentDegreeHeading = radiansToDegrees(agentTheta);
  <span class="hljs-keyword">var</span> newAgentDegreeHeading = agentDegreeHeading - degreeChange;
  <span class="hljs-keyword">var</span> newTheta = normalize(degreesToRadians(newAgentDegreeHeading));

  agent.SET_HEADING(newTheta);
}

<span class="hljs-keyword">var</span> right = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">degreeChange,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>agent has two thetas
one theta is the theta of the model
the other theta is the theta of the agent</p>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>the agent theta,,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>take the current heading
convert to degree
add degreeChange
convert to radian
normalize
pass to set heading</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentDegreeHeading = radiansToDegrees(agentTheta);
  <span class="hljs-keyword">var</span> newAgentDegreeHeading = agentDegreeHeading + degreeChange;
  <span class="hljs-keyword">var</span> newTheta = normalize(degreesToRadians(newAgentDegreeHeading));

  agent.SET_HEADING(newTheta);
}

<span class="hljs-keyword">var</span> checkCanMove = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">agent</span>)</span>{

}

<span class="hljs-keyword">var</span> randomXCoord = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">environment</span>)</span>{
  <span class="hljs-keyword">return</span> environment.cols * <span class="hljs-built_in">Math</span>.random();
}

<span class="hljs-keyword">var</span> randomYCoord = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">environment</span>)</span>{
  <span class="hljs-keyword">return</span> environment.rows * <span class="hljs-built_in">Math</span>.random();
}

<span class="hljs-keyword">var</span> distanceToAgentOrCell = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callingAgent,target</span>)</span>{

  <span class="hljs-keyword">var</span> callingAgentLocation = callingAgent.LOCATION();</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>check if target is agent or cell
agents have a myId property
cells don’t!
a potentially brittle check, but it works for now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span>(target.myId){</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>agent case
get the two agents locations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> targetLocation = target.LOCATION();</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>return the distance between</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> DISTANCE(callingAgentLocation.x,callingAgentLocation.y,targetLocation.x,targetLocation.y);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(target.coords){</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>cell case
returns the distance to the center of the cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> cellCenterX = target.coords.col + <span class="hljs-number">0.5</span>
    <span class="hljs-keyword">var</span> cellCenterY = target.coords.row + <span class="hljs-number">0.5</span>

    <span class="hljs-keyword">return</span> DISTANCE(callingAgentLocation.x,callingAgentLocation.y,cellCenterX,cellCenterY)

  } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>throw an error
not sure how throw appropriate erros in Nova’s javascript</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    print(<span class="hljs-string">"your target is not a cell or agent"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

}

<span class="hljs-keyword">var</span> patchAhead = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">distance, agent, environment</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>agent has two thetas
one theta is the theta of the model
the other theta is the theta of the agent</p>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>the agent theta,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>we use theta and distance to find a coordinate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> normalizedTheta = normalize(agentTheta);


  <span class="hljs-keyword">var</span> dx = distance * COS(normalizedTheta);
  <span class="hljs-keyword">var</span> dy = distance * SIN(normalizedTheta);

  <span class="hljs-keyword">var</span> nextX = agentX + dx;
  <span class="hljs-keyword">var</span> nextY = agentY + dy;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>we use that coordinate to find and return a cell</p>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>TODO: Check for whether this coordinate is inbounds or not
Needs a better way to pass in the environment that Super
This will break in a confusing way if not called by an agent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(checkInBounds(nextY,nextX,environment)){
    <span class="hljs-keyword">return</span> agent.CELL(nextY,nextX);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}

<span class="hljs-keyword">var</span> patchAt = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dx,dy,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>the agent theta,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;

  <span class="hljs-keyword">var</span> targetX = agentX + dx;
  <span class="hljs-keyword">var</span> targetY = agentY + dy;

  <span class="hljs-keyword">return</span> agent.CELL(targetY,targetX);
}

<span class="hljs-keyword">var</span> patchAtHeadingAndDistance = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">theta,distance,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>the agent theta,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;

  <span class="hljs-keyword">var</span> normalizedTheta = normalize(theta);

  <span class="hljs-keyword">var</span> dx = distance * COS(normalizedTheta);
  <span class="hljs-keyword">var</span> dy = distance * SIN(normalizedTheta);

  <span class="hljs-keyword">var</span> targetX = agentX + dx;
  <span class="hljs-keyword">var</span> targetY = agentY + dy;

  <span class="hljs-keyword">return</span> agent.CELL(targetY,targetX);
}

<span class="hljs-keyword">var</span> patchHere = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>the agent theta,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;

  <span class="hljs-keyword">return</span> agent.CELL(agentY,agentX);

}

<span class="hljs-keyword">var</span> patchLeftAndAhead = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">degreeChange,distance,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>agent has two thetas
one theta is the theta of the model
the other theta is the theta of the agent</p>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>the agent theta,,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>take the current heading
convert to degree
add degreeChange
convert to radian
normalize
pass to set heading</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentDegreeHeading = radiansToDegrees(agentTheta);
  <span class="hljs-keyword">var</span> newAgentDegreeHeading = agentDegreeHeading - degreeChange;
  <span class="hljs-keyword">var</span> newTheta = normalize(degreesToRadians(newAgentDegreeHeading));

  <span class="hljs-keyword">var</span> dx = distance * COS(newTheta);
  <span class="hljs-keyword">var</span> dy = distance * SIN(newTheta);

  <span class="hljs-keyword">var</span> targetX = agentX + dx;
  <span class="hljs-keyword">var</span> targetY = agentY + dy;

  <span class="hljs-keyword">return</span> agent.CELL(targetY,targetX)
}

<span class="hljs-keyword">var</span> patchRightAndAhead = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">degreeChange,distance,agent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>agent has two thetas
one theta is the theta of the model
the other theta is the theta of the agent</p>

            </div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>the agent theta,,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentTheta = agent.LOCATION().theta;
  <span class="hljs-keyword">var</span> agentX = agent.LOCATION().x;
  <span class="hljs-keyword">var</span> agentY = agent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>the model theta,y,x, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> modelTheta = agent.theta;
  <span class="hljs-keyword">var</span> modelX = agent.x;
  <span class="hljs-keyword">var</span> modelY = agent.y;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>take the current heading
convert to degree
add degreeChange
convert to radian
normalize
pass to set heading</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> agentDegreeHeading = radiansToDegrees(agentTheta);
  <span class="hljs-keyword">var</span> newAgentDegreeHeading = agentDegreeHeading + degreeChange;
  <span class="hljs-keyword">var</span> newTheta = normalize(degreesToRadians(newAgentDegreeHeading));

  <span class="hljs-keyword">var</span> dx = distance * COS(newTheta);
  <span class="hljs-keyword">var</span> dy = distance * SIN(newTheta);

  <span class="hljs-keyword">var</span> targetX = agentX + dx;
  <span class="hljs-keyword">var</span> targetY = agentY + dy;


  <span class="hljs-keyword">return</span> agent.CELL(targetY,targetX);
}


<span class="hljs-keyword">var</span> towards = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callingAgentOrCell, targetAgent</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>target agent has two potentially different theta,x,y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> targetAgentTheta = targetAgent.LOCATION().theta;
  <span class="hljs-keyword">var</span> targetAgentX = targetAgent.LOCATION().x;
  <span class="hljs-keyword">var</span> targetAgentY = targetAgent.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>model theta,x,y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> targetAgentModelTheta = targetAgent.theta;
  <span class="hljs-keyword">var</span> targetAgentModelX = targetAgent.x;
  <span class="hljs-keyword">var</span> targetAgentModelY = targetAgent.y;

  print(callingAgentOrCell);</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>check if target is agent or cell
agents have a myId property
cells don’t!
a potentially brittle check, but it works for now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span>(callingAgentOrCell.myId){</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>the agent theta,,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> agentTheta = callingAgentOrCell.LOCATION().theta;
    <span class="hljs-keyword">var</span> agentX = callingAgentOrCell.LOCATION().x;
    <span class="hljs-keyword">var</span> agentY = callingAgentOrCell.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>the model theta,x,y, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> modelTheta = callingAgentOrCell.theta;
    <span class="hljs-keyword">var</span> modelX = callingAgentOrCell.x;
    <span class="hljs-keyword">var</span> modelY = callingAgentOrCell.y;

    <span class="hljs-keyword">var</span> deltaY = targetAgentY - agentY;
    <span class="hljs-keyword">var</span> deltaX = targetAgentX - agentX;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>in radians</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> thetaTowardsTarget = normalize(<span class="hljs-built_in">Math</span>.atan(deltaY / deltaX));

    <span class="hljs-keyword">return</span> thetaTowardsTarget;

  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(callingAgentOrCell.coords){</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>cell is calling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> cellX = callingAgentOrCell.coords.col + <span class="hljs-number">5</span>;
    <span class="hljs-keyword">var</span> cellY = callingAgentOrCell.coords.row + <span class="hljs-number">5</span>;

    <span class="hljs-keyword">var</span> deltaY = targetAgentY - cellY;
    <span class="hljs-keyword">var</span> deltaX = targetAgentX - cellX;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>in radians</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> thetaTowardsTarget = normalize(<span class="hljs-built_in">Math</span>.atan(deltaY / deltaX));

    <span class="hljs-keyword">return</span> thetaTowardsTarget;

  } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>throw an error
not sure how throw appropriate erros in Nova’s javascript
TODO: catch the error where the target is not an agent
TODO: Catch it earlier and exit the function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    print(<span class="hljs-string">"your caller is not a cell or agent"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

}

<span class="hljs-keyword">var</span> towardsXY = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callingAgentOrCell, targetX, targetY</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>TODO: Test and fix. Currently throws two unexpected errors when used in layoutCircle method
Currently the left half of the circle faces in. The right half faces out.
May have to do with implementaiton of towardsXY
Probably a simple trig mistake</p>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>check if target is agent or cell
agents have a myId property
cells don’t!
a potentially brittle check, but it works for now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

  print(callingAgentOrCell.myId + <span class="hljs-string">"calling"</span>);

  <span class="hljs-keyword">if</span>(callingAgentOrCell.myId){</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>the agent theta,,x,y which is determined by SET_THETA and MOVE(x,y)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> agentTheta = callingAgentOrCell.LOCATION().theta;
    <span class="hljs-keyword">var</span> agentX = callingAgentOrCell.LOCATION().x;
    <span class="hljs-keyword">var</span> agentY = callingAgentOrCell.LOCATION().y;</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>the model theta,x,y, which is a stock value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> modelTheta = callingAgentOrCell.theta;
    <span class="hljs-keyword">var</span> modelX = callingAgentOrCell.x;
    <span class="hljs-keyword">var</span> modelY = callingAgentOrCell.y;

    <span class="hljs-keyword">var</span> deltaY = targetY - agentY;
    <span class="hljs-keyword">var</span> deltaX = targetX - agentX;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>in radians</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> thetaTowardsTarget = normalize(<span class="hljs-built_in">Math</span>.atan(deltaY / deltaX));

    <span class="hljs-keyword">return</span> thetaTowardsTarget;

  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(callingAgentOrCell.coords){</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>cell is calling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> cellX = callingAgentOrCell.coords.col + <span class="hljs-number">5</span>;
    <span class="hljs-keyword">var</span> cellY = callingAgentOrCell.coords.row + <span class="hljs-number">5</span>;

    <span class="hljs-keyword">var</span> deltaY = targetY - cellY;
    <span class="hljs-keyword">var</span> deltaX = targetX - cellX;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>in radians</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> thetaTowardsTarget = normalize(<span class="hljs-built_in">Math</span>.atan(deltaY / deltaX));

    <span class="hljs-keyword">return</span> thetaTowardsTarget;

  } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>throw an error
not sure how throw appropriate erros in Nova’s javascript
TODO: Catch it earlier and exit the function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    print(<span class="hljs-string">"your caller is not a cell or agent"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}



layoutCircle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cell, radius, agentVector</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>TODO: Fix theta setting.
Currently the left half of the circle faces in. The right half faces out.
May have to do with implementaiton of towardsXY</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> circleCenterX = cell.coords.col + <span class="hljs-number">0.5</span>;
  <span class="hljs-keyword">var</span> circleCenterY = cell.coords.row + <span class="hljs-number">0.5</span>;
  <span class="hljs-keyword">var</span> agentX;
  <span class="hljs-keyword">var</span> agentY;
  <span class="hljs-keyword">var</span> agent;
  <span class="hljs-keyword">var</span> agentCount = agentVector.length;
  <span class="hljs-keyword">var</span> agentHeading;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>circleCenterX + radius <em> Math.cos(2</em>this.agent.id/this.agentvector.count<em>Math.PI);
circleCenterY + radius </em> Math.sin(2<em>this.agent.id/this.agentvector.count</em>Math.PI);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; agentCount; i++){

    agent = agentVector[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>equation for points on a circle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    agentX = circleCenterX + radius * <span class="hljs-built_in">Math</span>.cos(<span class="hljs-number">2</span>*agent.myId/agentCount*<span class="hljs-built_in">Math</span>.PI);
    agentY = circleCenterY + radius * <span class="hljs-built_in">Math</span>.sin(<span class="hljs-number">2</span>*agent.myId/agentCount*<span class="hljs-built_in">Math</span>.PI);</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>set initial value for agent
in this implementation, the function can only be called during init
agent.init_x = agentX;
agent.init_y = agentY;</p>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>alternately they can be moved to these locations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    agent.MOVE(agentX,agentY);</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>print(agent.myId);
print(agentCount);
set the heading away from the center point
away is just towards +Math.PI and normalized</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    agentHeading = normalize(towardsXY(agent,circleCenterX,circleCenterY) + <span class="hljs-built_in">Math</span>.PI)
    agentVector[i].SET_HEADING(agentHeading);
  }
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
